@using Wiggly
@namespace Wiggly.Models
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using DevExtreme.AspNet.Mvc
@model Wiggly.Entities.Transaction;
@{
    ViewData["Title"] = "Index";
    Layout = "_LayoutAdminLTEVendor";
}


<h1>Transaction</h1>

<p>
    <a asp-action="Index">Home Vendor</a>
</p>


@(Html.DevExtreme().DataGrid<Wiggly.Areas.Vendor.Models.TransactionInfoViewModel>()
    .DataSource(ds => ds.Mvc()
        .Controller("Transaction")
        .LoadAction("GetTransactions")
        .InsertAction("PostTransactions")
        .UpdateAction("PutTransactions")
        //.DeleteAction("DeleteTransactions")
        .Key("Id")
    )
    .Selection(s => s.Mode(SelectionMode.Single))
    .HoverStateEnabled(true)
    .ShowColumnLines(true)
    .ShowRowLines(true)
    .RowAlternationEnabled(true)
    .ShowBorders(true)
    .SearchPanel(searchPanel => searchPanel
        .Visible(true)
        .Width(240)
        .Placeholder("Search...")
    )
    .Columns(col =>
    {
        col.AddFor(m => m.TransactionID).Name("Transaction ID");
        col.AddFor(m => m.Farmer);
        col.AddFor(m => m.Amount);
        col.AddFor(m => m.BookDate);


        col.Add()
            .Type(GridCommandColumnType.Buttons)
            .Buttons(b =>
            {
                b.Add().Name(GridColumnButtonName.Edit);
                b.Add().Name(GridColumnButtonName.Delete);
                //b.Add().Name("Details")
                //    .Icon("info")
                //    .OnClick("onInfoIconClick")
                //;
                //b.Add().Name("ViewTopic")
                //    .Icon("doc")
                //    .OnClick("onTopicIconClick");
                //;

            });
    })
    .Editing(e => {
        e.UseIcons(true);
        e.Mode(GridEditMode.Popup)
        .AllowAdding(true)
        .AllowUpdating(true)
        .AllowDeleting(true)
        .Form(f => f.Items(items =>
        {
            items.AddGroup()
                .ColCount(2)
                .ColSpan(2)
                .Name("Transaction")
                .Items(gItem =>
                {
                    gItem.AddSimpleFor(m => m.Farmer).ColSpan(1).IsRequired(true)
                        .Editor(e => e.SelectBox()
                            .DataSource(ds => ds.Mvc()
                                .Controller("Transaction")
                                .LoadAction("GetFarmers")
                            )
                            .ItemTemplate(new JS("ItemTemplate"))
                            .DisplayExpr(new JS("dExpr"))
                            .ValueExpr("Id")
                            .SearchEnabled(true)
                            .Placeholder("Select Farmer")
                          );

                });
            items.AddGroup()
                .ColCount(2)
                .ColSpan(2)
                .Name("Kilos")
                .Items(gItem => {
                    gItem.AddSimpleFor(m => m.PaymentType).ColSpan(1).IsRequired(true).Editor(e => e.SelectBox().Placeholder("Select Status").DataSource(new JS("PaymentType")).DisplayExpr("Name").ValueExpr("Name"));

                });

        }).OnInitialized("onFormInitialized")
        );

    })
)



<script>
    var asdfasdf;
    var Status = [
        {
            "Name": "Pending"
        },
        {
            "Name": "Done"
        },
        {
            "Name": "Cancelled"
        }
    ];

    var PaymentType = [
        {
            "Name": "Bank Deposit"
        },
        {
            "Name": "Gcash"
        },
        {
            "Name": "Cash on Hand"
        }
    ];

    //ui components init
    var farmerSelectBox;

    let form;
    //custom form initialization
    function onFormInitialized(e) {
        form = e.component;
    }


    $.ajax("../Transaction/GetFarmers").done(function (data) {
        asdfasdf = data;
    });

    function ItemTemplate(data) {
        return data.Firstname + " " + data.LastName;
    }

    let dExpr = (item) => function () {
        if (item) {
            //console.log(item);
            return item.Firstname + " " + item.LastName;
        } else {
            console.log("no data")
        }
    }

</script>